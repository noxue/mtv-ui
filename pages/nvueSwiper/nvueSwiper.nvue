<template>
	<view>
		<!-- #ifdef MP -->
		<swiper :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'"
			:vertical="true" @animationfinish="animationfinish" @change="change" :current="current" :indicator-dots="false"
			@touchstart="mpTouchstart" @touchend="mpTouchend">
			<swiper-item v-for="(list,index) in dataList" :key="index">
				<view v-if="Math.abs(k-index)<=1">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						 -->
						<video v-if="isShow" :id="list._id+''+index" :loop="true" :muted="list.isplay" :controls="false"
							:http-cache="true" :page-gesture="false" :show-fullscreen-btn="false" :show-loading="false"
							:show-center-play-btn="false" :enable-progress-gesture="false" :src="list.src" @ended="ended"
							@click="tapVideoHover(list.state,$event)" @timeupdate="timeupdate($event,index)"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000; z-index: -1;'"
							:poster="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
					<!-- 	<image v-if="!list.playIng" :src="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; position: absolute;'" mode="aspectFit">
						</image> -->
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px;'">
						<image v-if="list.state=='pause'" class="playState" src="@/static/img/index/play.png"></image>
					</view>
					<view class="userInfo">
						<!-- 1.å¤´åƒ -->
						<image @click="tozuozhe" class="userAvatar" :src="list.href" mode="aspectFill"></image>
						<!-- 2.ç‚¹èµ -->
						<view @click="cLike(list.like);" style="opacity: 0.9; margin-top: 17px;">
							<image v-if="list.like" src="@/static/img/index/xin.png"
								style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<image v-if="!list.like" src="@/static/img/index/xin-2.png"
								style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; margin-top: 40px; font-weight: bold;"
								:class="{'likeNumActive':list.like}">{{list.like_n}}</text>
						</view>
						<!-- 3.è¯„è®º -->
						<view class="comment" @click="toComment(index)" style="opacity: 0.9; margin-top: 17px;">
							<image src="@/static/img/index/liaotian-2.png"
								style="width: 35px; height: 35px; position: absolute; right: 7px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 40px;">{{list.sms_n}}</text>
						</view>
						<!-- 4.åˆ†äº« -->
						<view @click="share" style="opacity: 0.9; margin-top: 17px;">
							<image src="@/static/img/index/share-fill.png"
								style="width: 40px; height: 40px; position: absolute; right: 5px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; font-weight: bold; margin-top: 40px;">åˆ†äº«</text>
						</view>
					</view>
					<!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
					<view class="content">
						<text class="userName" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.title}}</text><!-- i={{i}} -->
						<text class="words"
							:style="'width: '+ (windowWidth - 90) +'px;'">{{list.msg}}-{{k+1}}</text><!-- k={{k}} -->
					</view>
					<!-- è¿›åº¦æ¡ -->
					<view v-if="k === index" @touchstart="touchstart" @touchmove="touchmove" @touchend="touchend"
						:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-left: '+ (windowWidth * 0.05) +'px; height: 40px; position: absolute; bottom: 10px;'">
						<!-- ä¸æ‹–åŠ¨æƒ…å†µä¸‹ -->
						<view>
							<!-- 1.åº•éƒ¨èƒŒæ™¯è¿›åº¦æ¡ -->
							<view
								:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #999999; opacity: 0.6;'">
							</view>
							<!-- 2.æ’­æ”¾çš„è¿›åº¦æ¡ -->
							<view v-if="!isTouch"
								:style="'width: '+ ((windowWidth - (windowWidth*0.10)) * progressBarPercent) +'px; position: absolute; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #e6e4e7; '">
							</view>
							<!--  -->
							<view v-if="isTouch"
								:style="'width: '+ (videoStartPositon + addPositon) +'px; position: absolute; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #e6e4e7; '">
							</view>
						</view>
					</view>
				</view>
			</swiper-item>
		</swiper>
		<!-- #endif -->
		<!-- #ifdef H5 -->
		<swiper :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'"
			:vertical="true" @animationfinish="animationfinish" @change="change" :current="current" :indicator-dots="false"
			:duration="duration">
			<swiper-item v-for="(list,index) in dataList" :key="index" v-if="index < 10">
				<view v-if="Math.abs(k-index)<=1">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						v-if="Math.abs(k-index)<=1"
						 -->
						<video v-if="isShow" :id="list._id+''+index" :loop="true" :muted="list.isplay" :controls="false"
							:http-cache="true" :page-gesture="false" :show-fullscreen-btn="false" :show-loading="false"
							:show-center-play-btn="false" :enable-progress-gesture="false" :src="list.src" @ended="ended"
							@click="tapVideoHover(list.state,$event)" @timeupdate="timeupdate($event,index)"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000; z-index: -1;'"
							:poster="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
						<image v-if="!list.playIng" :src="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"
							:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; position: absolute;'" mode="aspectFit">
						</image>
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px;'">
						<image v-if="list.state=='pause'" class="playState" src="@/static/img/index/play.png"></image>
					</view>
					<view class="userInfo">
						<!-- 1.å¤´åƒ -->
						<image @click="tozuozhe" class="userAvatar" :src="list.href" mode="aspectFill"></image>
						<!-- 2.ç‚¹èµ -->
						<view @click="cLike(list.like);" style="opacity: 0.9; margin-top: 17px;">
							<image v-if="list.like" src="@/static/img/index/xin.png"
								style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<image v-if="!list.like" src="@/static/img/index/xin-2.png"
								style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; margin-top: 40px; font-weight: bold;"
								:class="{'likeNumActive':list.like}">{{list.like_n}}</text>
						</view>
						<!-- 3.è¯„è®º -->
						<view class="comment" @click="toComment(index)" style="opacity: 0.9; margin-top: 17px;">
							<image src="@/static/img/index/liaotian-2.png"
								style="width: 35px; height: 35px; position: absolute; right: 7px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 40px;">{{list.sms_n}}</text>
						</view>
						<!-- 4.åˆ†äº« -->
						<view @click="share" style="opacity: 0.9; margin-top: 17px;">
							<image src="@/static/img/index/share-fill.png"
								style="width: 40px; height: 40px; position: absolute; right: 5px;"></image>
							<text
								style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; font-weight: bold; margin-top: 40px;">åˆ†äº«</text>
						</view>
						<view @click="dealVoice" style="margin-top: 17px;">
							<view style="width: 48px; height: 48px; border-radius: 50px; position: absolute; right: 2.5px;">
								<image :style="'width: 48px; height: 48px; border-radius: 50px; transform: rotate('+ rotates +'deg);'"
									src="@/static/img/index/bfq.png" mode="aspectFill"></image>
								<image v-if="showPlay"
									:style="'width: 30px; height: 30px; margin-top: 9px; margin-left: 9px; position: absolute; border-radius: 50px; transform: rotate('+ rotates +'deg);'"
									:src="list.href" mode="aspectFill"></image>
							</view>
						</view>
					</view>
					<!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
					<view class="content">
						<text class="userName" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.title}}</text><!-- i={{i}} -->
						<text class="words"
							:style="'width: '+ (windowWidth - 90) +'px;'">{{list.msg}}-{{k+1}}</text><!-- k={{k}} -->
					</view>
					<!-- è¿›åº¦æ¡ -->
					<view v-if="k === index" @touchstart="touchstart" @touchmove="touchmove" @touchend="touchend"
						:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-left: '+ (windowWidth * 0.05) +'px; height: 40px; position: absolute; bottom: 10px;'">
						<!-- ä¸æ‹–åŠ¨æƒ…å†µä¸‹ -->
						<view>
							<!-- 1.åº•éƒ¨èƒŒæ™¯è¿›åº¦æ¡ -->
							<view
								:style="'width: '+ (windowWidth - (windowWidth*0.10)) +'px; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #999999; opacity: 0.6;'">
							</view>
							<!-- 2.æ’­æ”¾çš„è¿›åº¦æ¡ -->
							<view v-if="!isTouch"
								:style="'width: '+ ((windowWidth - (windowWidth*0.10)) * progressBarPercent) +'px; position: absolute; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #e6e4e7; '">
							</view>
							<!--  -->
							<view v-if="isTouch"
								:style="'width: '+ (videoStartPositon + addPositon) +'px; position: absolute; margin-top: 18px; height: 5px; border-radius: 10px; background-color: #e6e4e7; '">
							</view>
						</view>
					</view>
				</view>
			</swiper-item>
		</swiper>
		<!-- #endif -->
	</view>
</template>

<script>
	let audo = uni.createInnerAudioContext()
	audo.loop = true

	export default {
		data() {
			return {
				moviesInfo: {},
				windowWidth: 0,
				windowHeight: 0,
				platform: "",
				model: "",
				deleteHeight: 0,
				dataList: [],
				k: 0,
				oldVideo: "",
				voice: "",
				timeout: "",
				current: 0,
				boxStyle: { //è§†é¢‘ï¼Œå›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
					'height': 0,
					'width': 0,
				},

				videoID: "",
				isShow: false,

				showPlay: false, //è½¬è½®æ˜¾ç¤ºæ§åˆ¶
				rotates: 0, //è½¬è½®æ—‹è½¬è§’åº¦
				rotateTime: "", //è½¬è½®é€’å½’äº‹ä»¶æ§åˆ¶
				xrotats: "",

				mpcleartime: "",

				isClick: false,

				changeTimeout: "",
				mptime: 0,
				mpstartTime: 0,

				duration: 500,
				// -- è¿›åº¦æ¡ç›¸å…³ -- start
				videoStartPositon: 0,
				progressBarPercent: 0,
				touchStartPosition: 0,
				addPositon: 0,
				timeduration: 0,
				isTouch: false,
				// -- è¿›åº¦æ¡ç›¸å…³ -- end
			}
		},
		components: {

		},
		watch: {

		},
		onLoad(e) {
			// çŸ­è§†é¢‘id
			if (e.mid || e.moviesId) {
				this.moviesId = parseInt(e.mid || e.moviesId)
			}
			// è§†é¢‘id
			if (e.vid || e.videosId) {
				this.videosId = parseInt(e.vid || e.videosId)
			}

			this.platform = uni.getSystemInfoSync().platform
			this.model = uni.getSystemInfoSync().model
			var model = this.model
			if (this.platform == 'ios' && (model !== 'iPhone6' || model !== 'iPhone6s' || model !== 'iPhone7' || model !==
					'iPhone8')) {
				this.deleteHeight = 0 //æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
			}
			this.windowWidth = uni.getSystemInfoSync().windowWidth
			this.windowHeight = uni.getSystemInfoSync().windowHeight
			this.boxStyle.width = this.windowWidth + 'px' //ç»™å®½åº¦åŠ px
			this.boxStyle.height = this.windowHeight - this.deleteHeight; //æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
			this.getMoviesDetail();
			this.get2();
			// this.get() //åˆšè¿›å…¥é¡µé¢åŠ è½½æ•°æ®
			// #ifndef MP
			this.rotateX();
			// #endif
		},
		onShow() {
			console.log('å›åˆ°å‰å°');
			if (this.dataList.length !== 0) {
				// #ifdef MP
				this.dataList[this.k].state = 'play';
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
				// #endif
				// #ifdef H5
				if (this.isClick) {
					this.dataList[this.k].state = 'play';
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
					audo.play()
				}
				// #endif
			}
		},
		onHide() {
			// #ifdef MP
			this.dataList[this.k].state = 'pause';
			uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).pause()
			// #endif
			// #ifdef H5
			if (this.isClick) {
				this.dataList[this.k].state = 'pause';
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).pause()
				audo.pause()
			}
			// #endif
			console.log('åˆ°åå°');
		},
		methods: {
			// è·å–çŸ­å‰§è¯¦æƒ…
			getMoviesDetail() {
				this.$api.movies.detail.request({}, {
					url: this.$hostConfig.apiHost + '/' + 'movies/' + 1
				}).then((data) => {
					this.moviesInfo = data;
					// this.setStorage();
				})
			},
			mpTouchend() {
				this.mptime = (new Date() / 1000) - this.mpstartTime;
			},
			mpTouchstart() {
				this.mpstartTime = (new Date() / 1000);
			},
			dealVoice() {
				uni.showToast({
					title: 'å¤„ç†å£°éŸ³',
					icon: 'none'
				})
			},
			clearToTime() {
				//æ¸…ç†å®šæ—¶å™¨
				for (let i = 0; i < 20; i++) {
					clearTimeout(this.rotateTime);
					clearTimeout(this.xrotats);
					this.showPlay = false;
					this.rotates = 0;
				}
			},
			clearTime() {
				//æ¸…ç†å®šæ—¶å™¨
				for (let i = 0; i < 20; i++) {
					clearTimeout(this.rotateTime);
					clearTimeout(this.xrotats);
				}
			},
			rotateX() {
				// clearTimeout(this.rotateTime);
				this.rotateTime = setTimeout(() => {
					this.rotateX();
					this.showPlay = true;
					this.rotates += 1;
				}, 30)
			},
			closeScrollview() {
				// ç‚¹å‡»è¯„è®ºé‡Œé¢çš„å‰å‰ï¼Œå°±ä¼šå…³é—­è¯„è®º
				this.$refs.pinglun.close();
			},
			ended() {
				// 1.æ’­æ”¾å½“å‰è§†é¢‘ç»“æŸæ—¶è§¦å‘ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªè§†é¢‘
				// this.current = this.k+1
			},
			// ---- è¿›åº¦æ¡ç›¸å…³ --- start
			touchstart(e) {
				// console.log(e);
				this.isTouch = true;
				// #ifdef H5
				if (this.isClick) {
					this.addPositon = 0;
					this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10)) * this.progressBarPercent;
					this.touchStartPosition = e.changedTouches[0].clientX;
				}
				// #endif
				// #ifdef MP
				this.addPositon = 0;
				this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10)) * this.progressBarPercent;
				this.touchStartPosition = e.changedTouches[0].clientX;
				// #endif
			},
			touchmove(e) {
				// console.log(e);
				// #ifdef H5
				if (this.isClick) {
					let num = e.changedTouches[0].clientX - this.touchStartPosition;
					if ((this.videoStartPositon + num) <= (this.windowWidth - (this.windowWidth * 0.10))) {
						this.addPositon = e.changedTouches[0].clientX - this.touchStartPosition;
					} else {
						this.addPositon = 0;
						this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10));
					}
				}
				// #endif
				// #ifdef MP
				let num = e.changedTouches[0].clientX - this.touchStartPosition;
				if ((this.videoStartPositon + num) <= (this.windowWidth - (this.windowWidth * 0.10))) {
					this.addPositon = e.changedTouches[0].clientX - this.touchStartPosition;
				} else {
					this.addPositon = 0;
					this.videoStartPositon = (this.windowWidth - (this.windowWidth * 0.10));
				}
				// #endif
			},
			touchend(e) {
				// #ifdef H5
				if (this.isClick) {
					let per = Number((this.videoStartPositon + this.addPositon) / (this.windowWidth - (this.windowWidth * 0.10)));
					let timeSubmit = parseInt(this.timeduration * per)
					audo.seek(timeSubmit)
					audo.play()
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).seek(timeSubmit)
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
					this.dataList[this.k].state = 'play'
					setTimeout(() => {
						this.isTouch = false;
					}, 500)
				}
				// #endif
				// #ifdef MP
				let per = Number((this.videoStartPositon + this.addPositon) / (this.windowWidth - (this.windowWidth * 0.10)));
				let timeSubmit = parseInt(this.timeduration * per)
				audo.seek(timeSubmit)
				audo.play()
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).seek(timeSubmit)
				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
				setTimeout(() => {
					this.isTouch = false;
				}, 500)
				// #endif
			},
			timeupdate(event, index) {
				// è§¦å‘è¿›åº¦æ¡æ›´æ–°
				// console.log(event,index);
				if (index === this.k) {
					this.timeduration = event.detail.duration;
					this.progressBarPercent = parseFloat(Number(event.detail.currentTime / event.detail.duration));
				}
			},
			// ---- è¿›åº¦æ¡ç›¸å…³ --- ending
			//ç‚¹å‡»æ’­æ”¾&&æš‚åœ
			tapVideoHover(state, event) {
				console.log('state--', state);
				if (state == 'play' || state == 'continue') {
					this.dataList[this.k].state = 'pause';
				} else {
					this.dataList[this.k].state = 'continue';
				}
				if (this.dataList[this.k].state == 'continue') {
					console.log('è¿›æ¥äº†----')
					this.isClick = true;
					this.dataList[this.k].playIng = true
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
					// #ifdef MP
					this.dataList[this.k].isplay = false
					// #endif
					// #ifdef H5
					audo.play()
					// #endif
				}
				if (this.dataList[this.k].state == 'pause') {
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).pause(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
					// #ifdef MP
					this.dataList[this.k].isplay = true
					// #endif
					// #ifdef H5
					audo.pause()
					// #endif
				}
			},
			change(event) {
				let oldK = this.k;
				this.k = event.detail.current

				this.kPlay(this.k, oldK);
			},
			animationfinish(event) {
				// 1.è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªè§†é¢‘å°±è¿›å…¥ get() æ–¹æ³•åŠ è½½è§†é¢‘è¿›å…¥åˆ—è¡¨
				if (this.k == this.dataList.length - 1) {
					this.GET()
				}
			},
			//æ¯ä¸€ç»„ç»“æŸæ—¶æ–°çš„è¯·æ±‚
			GET() {
				uni.request({
					url: 'https://bdb24c6d-8c19-4f80-8e7e-c9c9f037f131.bspapp.com/video',
					method: 'POST',
					data: {
						info: 'get_video'
					},
					success: (res) => {
						var msg = res.data.data
						// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
						for (let i = 0; i < msg.length; i++) {
							this.dataList.push(msg[i])
						}
					}
				})
			},
			get2() {
				uni.request({
					url: 'https://mtv.dot2.com/api/movies/1/videos',
					header: {
						token: 'f04823927b6c4e1a9724bccbddf07d48'
					},
					success: (res) => {
						console.log(res);

						this.isShow = false;
						var msg = res.data.data
						// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
						for (let i = 0; i < msg.length; i++) {
							msg[i]._id = 'video_' + i;
							this.dataList.push(msg[i])
						}

						if (this.videosId) {
							this.k = this.videosId;
							this.current = this.k;
							this.get(this.videosId);
						} else {
							this.get(this.k);
						}
					}
				})
			},
			// é¦–æ¬¡åŠ è½½
			get(index) {
				console.log('å•ä¸ªè§†é¢‘', index);
				let info = this.dataList[index];

				uni.request({
					url: 'https://mtv.dot2.com/api/movies/videos/' + info.id,
					header: {
						token: 'f04823927b6c4e1a9724bccbddf07d48'
					},
					success: (res) => {
						console.log('å•ä¸ªè§†é¢‘', res);
						info.src = res.data.data.video;
						console.log(this.dataList);
						console.log(info);
						// 3.æ’­æ”¾å½“å‰è§†é¢‘
						setTimeout(() => {
							this.isShow = true;
							// #ifdef H5
							info.isplay = true
							// #endif
							// #ifdef MP
							// å¦‚æœæ˜¯å°ç¨‹åºç«¯
							info.isplay = false
							info.state = 'play'
							// #endif
							info.playIng = true
							setTimeout(() => {
								// #ifdef H5
								uni.createVideoContext(info._id + '' + this.k, this).seek(0)
								uni.createVideoContext(info._id + '' + this.k, this).pause()
								info.state = 'pause';
								audo.src = info.src;
								// #endif
								// #ifdef MP
								uni.createVideoContext(info._id + '' + this.k, this).play()
								// #endif
							}, 500)
						}, 200)
						this.videoID = info._id
					}
				})

				// // 1.è¿™é‡Œå¼•å…¥åç«¯è¯·æ±‚æ•°æ®
				// // var msg = userList
				// uni.request({
				// 	url: 'https://bdb24c6d-8c19-4f80-8e7e-c9c9f037f131.bspapp.com/video',
				// 	method: 'POST',
				// 	data: {
				// 		info: 'get_video'
				// 	},
				// 	success: (res) => {
				// 		this.isShow = false;
				// 		var msg = res.data.data
				// 		// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
				// 		for (let i = 0; i < msg.length; i++) {
				// 			this.dataList.push(msg[i])
				// 		}
				// 		// 3.æ’­æ”¾å½“å‰è§†é¢‘
				// 		setTimeout(() => {
				// 			this.isShow = true;
				// 			// #ifdef H5
				// 			this.dataList[this.k].isplay = true
				// 			// #endif
				// 			// #ifdef MP
				// 			// å¦‚æœæ˜¯å°ç¨‹åºç«¯
				// 			this.dataList[this.k].isplay = false
				// 			this.dataList[this.k].state = 'play'
				// 			// #endif
				// 			this.dataList[this.k].playIng = true
				// 			setTimeout(() => {
				// 				// #ifdef H5
				// 				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).seek(0)
				// 				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).pause()
				// 				this.dataList[this.k].state = 'pause';
				// 				audo.src = this.dataList[this.k].src;
				// 				// #endif
				// 				// #ifdef MP
				// 				uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
				// 				// #endif
				// 			}, 500)
				// 		}, 200)
				// 		this.videoID = this.dataList[this.k]._id
				// 	}
				// })
			},
			videoPlay(k) {
				// #ifdef MP
				// å¦‚æœæ˜¯å°ç¨‹åºç«¯
				clearTimeout(this.changeTimeout);
				this.dataList[k].isplay = false
				setTimeout(() => {
					this.dataList[k].playIng = true
				}, 250)
				if (this.mptime < 0.2) {
					this.changeTimeout = setTimeout(() => {
						uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
					}, 1400)
				} else {
					uni.createVideoContext(this.dataList[this.k]._id + '' + this.k, this).play()
				}
				// #endif
				// #ifdef H5
				this.dataList[k].isplay = true
				audo.src = this.dataList[k].src
				console.log('è¿™é‡Œå¥‡', this.isClick);
				if (this.isClick) {
					setTimeout(() => {
						console.log('è¿™é‡Œå¥‡', 200);
						if (typeof WeixinJSBridge == "undefined") {
							setTimeout(() => {
								console.log('è¿™é‡Œå¥‡', 500);
								audo.play()
								uni.createVideoContext(this.dataList[k]._id + '' + k, this).seek(0)
								uni.createVideoContext(this.dataList[k]._id + '' + k, this).play()
								setTimeout(() => {
									this.dataList[k].playIng = true
								}, 100)
							}, 100)
						} else {
							WeixinJSBridge.invoke('getNetworkType', {}, e => {
								setTimeout(() => {
									console.log('è¿™é‡Œå¥‡', 200);
									audo.play()
									uni.createVideoContext(this.dataList[k]._id + '' + k, this).seek(0)
									uni.createVideoContext(this.dataList[k]._id + '' + k, this).play()
									setTimeout(() => {
										this.dataList[k].playIng = true
									}, 100)
								}, 100)
							})
						}
					}, 100)
				} else {
					audo.pause()
					this.dataList[k].state = 'pause'
					uni.createVideoContext(this.dataList[k]._id + '' + k, this).seek(0)
					uni.createVideoContext(this.dataList[k]._id + '' + k, this).pause()
				}
				// #endif
				var p = k + 1;
				console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]._id + '' + p)
			},
			kPlay(k, old_k) {
				// console.log(k, old_k)
				this.progressBarPercent = 0;
				// #ifndef MP
				this.clearToTime();
				// #endif
				this.isShow = false
				this.dataList[old_k].playIng = false //å¦‚æœè§†é¢‘æš‚åœï¼Œå°±åŠ è½½å°é¢
				this.dataList[old_k].isplay = true
				this.dataList[old_k].state = 'pause'
				console.log('é¢„ç•™ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[old_k]._id + '' + old_k)
				// 2.0ç‰ˆæœ¬å·²ç»å»æ‰äº†ä¸‹é¢è¿™ä¸€å¥ï¼Œè§†é¢‘ä¸ç”¨æš‚åœï¼Œåªéœ€è¦æŠŠå£°éŸ³ç¦æ­¢å°±è¡Œ
				uni.createVideoContext(this.dataList[old_k]._id + '' + old_k, this)
					.stop() //å¦‚æœè§†é¢‘æš‚åœï¼Œé‚£ä¹ˆæ—§è§†é¢‘åœæ­¢ï¼Œè¿™é‡Œçš„this.dataList[old_k]._id + '' + old_kï¼Œåé¢åŠ  old_k æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªè§†é¢‘çš„ id å€¼ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥å¤§ç¨‹åº¦çš„é¿å…ä¸²éŸ³é—®é¢˜
				console.log('å·²ç»æš‚åœ --> ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï½') //æç¤º
				this.dataList[k].state = 'play'
				this.isShow = true
				this.xrotats = setTimeout(() => {
					this.showPlay = true;
					// #ifndef MP
					this.rotateX();
					// #endif
				}, 200)


				if (this.dataList[k].src) {
					this.videoPlay(k);
				} else {
					let info = this.dataList[this.k];
					uni.request({
						url: 'https://mtv.dot2.com/api/movies/videos/' + info.id,
						header: {
							token: 'f04823927b6c4e1a9724bccbddf07d48'
						},
						success: (res) => {
							this.dataList[this.k].src = res.data.data.video;

							this.videoPlay(k);
						}
					})
				}
			},
			share() {
				uni.showToast({
					title: 'åˆ†äº«',
					icon: 'none'
				})
			},
			toComment(index) {
				// æ³¨æ„ç‚¹å‡»è¯„è®ºä¹‹åä¼šæ‰§è¡Œè¿™é‡Œ
				/*
				ï¼ˆ1ï¼‰å…ˆåŠ è½½ç¼“å†²
				ï¼ˆ2ï¼‰è·å–å½“å‰è§†é¢‘ ID ä¿¡æ¯
				ï¼ˆ3ï¼‰ğŸŒŸğŸŒŸğŸŒŸğŸŒŸé‡è¦ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
					- ä¸€å®šè¦è®°å¾—çœ‹ index.vue é‡Œé¢
					 uni.setStorageSync("user",this.peopleList[i]);
					 è¿™ä¸ªä¸œè¥¿ï¼Œç”¨äºå­˜å‚¨å½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚åœ¨ æ’ä»¶é‡Œé¢ä¼šä½¿ç”¨åˆ°è¿™ä¸ªä¸œè¥¿ï¼Œ
					 è®°å¾—å†™ä¸€ä¸‹ã€‚
					 
				ï¼ˆ4ï¼‰æ‰“å¼€è¯„è®º
				*/
				uni.showToast({
					title: 'åŠ è½½ä¸­...',
					icon: 'none',
					position: 'bottom',
					duration: 300
				})
				uni.setStorageSync("videoID", this.dataList[index]._id);
				this.videoID = this.dataList[index]._id;
				this.$refs.pinglun.open('bottom')
			},
			cLike(sss) {
				this.dataList[this.k].like = !this.dataList[this.k].like
				const video = this.dataList[this.k];
				sss ? video.like_n -= 1 : video.like_n += 1;
			}
		}
	}
</script>

<style>
	.container {
		background-color: #000000;
	}

	.item {
		/* width : 750rpx; */
		background-color: #000000;
		position: relative;
	}

	.videoHover {
		position: absolute;
		top: 0;
		left: 0;
		flex: 1;
		background-color: rgba(0, 0, 0, 0.1);
		justify-content: center;
		align-items: center;

		/* border-style: dashed;
		border-color: #DD524D;
		border-width: 1px; */
	}

	.playState {
		width: 160rpx;
		height: 160rpx;
		opacity: 0.2;
	}

	.userInfo {
		position: absolute;
		bottom: 110px;
		right: 10px;
		flex-direction: column;

	}

	.userAvatar {
		border-radius: 500%;
		margin-bottom: 15px;
		border-style: solid;
		border-width: 2px;
		border-color: #ffffff;
	}

	.userAvatar {
		width: 100rpx;
		height: 100rpx;
	}

	.likeIco,
	.shareIco,
	.commentIco {
		width: 60rpx;
		height: 60rpx;
		margin-top: 15px;
	}

	.likeNum,
	.commentNum,
	.shareTex {
		color: #ffffff;
		font-size: 30rpx;
		text-align: center;
		margin: 5px;
	}

	.likeNumActive {
		color: red;
	}

	.content {
		width: 620rpx;
		z-index: 99;
		position: absolute;
		bottom: 60px;
		/* justify-content: center; */
		padding: 15rpx;
		flex-direction: column;
		justify-content: flex-start;
		color: #ffffff;
		/* background-color: aqua; */
	}

	.userName {
		font-size: 30rpx;
		color: #ffffff;
		margin-top: 80upx;
	}

	.words {
		margin-top: 10rpx;
		font-size: 30rpx;
		color: #ffffff;
	}

	.root {
		background-color: #000000;
	}
</style>